<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  File: README
  
    &mdash; Documentation by YARD 0.9.27
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" />

  <link rel="stylesheet" href="css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "README";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><div id='filecontents'>
<h1 id="label-Re-3Amap+rdoc-image-3Ahttps-3A-2F-2Fgithub.com-2Foleander-2Fremap-2Factions-2Fworkflows-2Fmain.yml-2Fbadge.svg">Re:map <a href="https://github.com/oleander/remap/actions/workflows/main.yml"><img src="https://github.com/oleander/remap/actions/workflows/main.yml/badge.svg"></a></h1>

<blockquote>
<p><code>Re:map</code>; an expressive and feature-complete data mapper designed as a domain-specific language using Ruby 3.0. <code>Re:map</code> gives the developer the expressive power of JSONPath, without the hassle of using strings. Its compiler is written on top of an immutable, primitive data structure utilizing Rubys refinements &amp; pattern matching capabilities â€“ making it blazingly fast</p>
</blockquote>

<pre class="code ruby"><code class="ruby"><span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Mapper</span> &lt; <span style="color:#036;font-weight:bold">Remap</span>::<span style="color:#036;font-weight:bold">Base</span>
  option <span style="color:#A60">:date</span> <span style="color:#777"># &lt;= Custom required value</span>

  define <span style="color:#080;font-weight:bold">do</span>
    <span style="color:#777"># Fixed values</span>
    set <span style="color:#A60">:description</span>, <span style="color:#606">to</span>: value(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">This is a description</span><span style="color:#710">&quot;</span></span>)

    <span style="color:#777"># Semi-dynamic values</span>
    set <span style="color:#A60">:date</span>, <span style="color:#606">to</span>: option(<span style="color:#A60">:date</span>)

    <span style="color:#777"># Required rules</span>
    get <span style="color:#A60">:friends</span> <span style="color:#080;font-weight:bold">do</span>
      each <span style="color:#080;font-weight:bold">do</span>
        <span style="color:#777"># Post processors</span>
        map(<span style="color:#A60">:name</span>, <span style="color:#606">to</span>: <span style="color:#A60">:id</span>).adjust(&amp;<span style="color:#A60">:upcase</span>)

        <span style="color:#777"># Field conditions</span>
        get?(<span style="color:#A60">:age</span>).if <span style="color:#080;font-weight:bold">do</span> |age|
          (<span style="color:#00D">30</span>..<span style="color:#00D">50</span>).cover?(age)
        <span style="color:#080;font-weight:bold">end</span>

        <span style="color:#777"># Map to a finite set of values</span>
        get(<span style="color:#A60">:phones</span>) <span style="color:#080;font-weight:bold">do</span>
          each <span style="color:#080;font-weight:bold">do</span>
            map.enum <span style="color:#080;font-weight:bold">do</span>
              from <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">iPhone</span><span style="color:#710">&quot;</span></span>, <span style="color:#606">to</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">iOS</span><span style="color:#710">&quot;</span></span>
              value <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">iOS</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Android</span><span style="color:#710">&quot;</span></span>

              otherwise <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Unknown</span><span style="color:#710">&quot;</span></span>
            <span style="color:#080;font-weight:bold">end</span>
          <span style="color:#080;font-weight:bold">end</span>
        <span style="color:#080;font-weight:bold">end</span>
      <span style="color:#080;font-weight:bold">end</span>
    <span style="color:#080;font-weight:bold">end</span>

    <span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Linux</span> &lt; <span style="color:#036;font-weight:bold">Remap</span>::<span style="color:#036;font-weight:bold">Base</span>
      define <span style="color:#080;font-weight:bold">do</span>
        get <span style="color:#A60">:kernel</span>
      <span style="color:#080;font-weight:bold">end</span>
    <span style="color:#080;font-weight:bold">end</span>

    <span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Windows</span> &lt; <span style="color:#036;font-weight:bold">Remap</span>::<span style="color:#036;font-weight:bold">Base</span>
      define <span style="color:#080;font-weight:bold">do</span>
        get <span style="color:#A60">:price</span>
      <span style="color:#080;font-weight:bold">end</span>
    <span style="color:#080;font-weight:bold">end</span>

    <span style="color:#777"># Composable mappers</span>
    to <span style="color:#A60">:os</span> <span style="color:#080;font-weight:bold">do</span>
      map <span style="color:#A60">:computer</span>, <span style="color:#A60">:operating_system</span> <span style="color:#080;font-weight:bold">do</span>
        embed <span style="color:#036;font-weight:bold">Linux</span> | <span style="color:#036;font-weight:bold">Windows</span>
      <span style="color:#080;font-weight:bold">end</span>
    <span style="color:#080;font-weight:bold">end</span>

    get <span style="color:#A60">:cars</span> <span style="color:#080;font-weight:bold">do</span>
      each <span style="color:#080;font-weight:bold">do</span>
        <span style="color:#777"># Dig deep into a nested value</span>
        get <span style="color:#A60">:owners</span> <span style="color:#080;font-weight:bold">do</span>
          each <span style="color:#080;font-weight:bold">do</span>
            map <span style="color:#A60">:name</span>
          <span style="color:#080;font-weight:bold">end</span>
        <span style="color:#080;font-weight:bold">end</span>
      <span style="color:#080;font-weight:bold">end</span>
    <span style="color:#080;font-weight:bold">end</span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>

input = {
  <span style="color:#606">friends</span>: [
    {
      <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Lisa</span><span style="color:#710">&quot;</span></span>,
      <span style="color:#606">age</span>: <span style="color:#00D">20</span>,
      <span style="color:#606">phones</span>: [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">iPhone</span><span style="color:#710">&quot;</span></span>]
    }, {
      <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Jane</span><span style="color:#710">&quot;</span></span>,
      <span style="color:#606">age</span>: <span style="color:#00D">40</span>,
      <span style="color:#606">phones</span>: [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Samsung</span><span style="color:#710">&quot;</span></span>]
    }
  ],
  <span style="color:#606">computer</span>: {
    <span style="color:#606">operating_system</span>: {
      <span style="color:#606">kernel</span>: <span style="color:#A60">:latest</span>
    }
  },
  <span style="color:#606">cars</span>: [
    {
      <span style="color:#606">owners</span>: [
        {
          <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">John</span><span style="color:#710">&quot;</span></span>
        }
      ]
    }
  ]
}

output = {
  <span style="color:#606">friends</span>: [
    {
      <span style="color:#606">id</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">LISA</span><span style="color:#710">&quot;</span></span>,
      <span style="color:#606">phones</span>: [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">iOS</span><span style="color:#710">&quot;</span></span>]
    }, {
      <span style="color:#606">age</span>: <span style="color:#00D">40</span>,
      <span style="color:#606">id</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">JANE</span><span style="color:#710">&quot;</span></span>,
      <span style="color:#606">phones</span>: [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Unknown</span><span style="color:#710">&quot;</span></span>]
    }
  ],
  <span style="color:#606">description</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">This is a description</span><span style="color:#710">&quot;</span></span>,
  <span style="color:#606">cars</span>: [{ <span style="color:#606">owners</span>: [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">John</span><span style="color:#710">&quot;</span></span>] }],
  <span style="color:#606">date</span>: be_a(<span style="color:#036;font-weight:bold">Date</span>),
  <span style="color:#606">os</span>: {
    <span style="color:#606">kernel</span>: <span style="color:#A60">:latest</span>
  }
}

<span style="color:#036;font-weight:bold">Mapper</span>.call(input, <span style="color:#606">date</span>: <span style="color:#036;font-weight:bold">Date</span>.today).result == output
</code></pre>

<h2 id="label-Examples">Examples</h2>

<h3 id="label-Map+a+value+from+one+path+to+another">Map a value from one path to another</h3>

<pre class="code ruby"><code class="ruby"><span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Mapper</span> &lt; <span style="color:#036;font-weight:bold">Remap</span>::<span style="color:#036;font-weight:bold">Base</span>
  define <span style="color:#080;font-weight:bold">do</span>
    map <span style="color:#A60">:person</span>, <span style="color:#A60">:name</span>, <span style="color:#606">to</span>: <span style="color:#A60">:nickname</span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>
</code></pre>

<blockquote>
<p><code>map</code> and <code>to</code> can be flipped around</p>
</blockquote>

<pre class="code ruby"><code class="ruby"><span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Mapper</span> &lt; <span style="color:#036;font-weight:bold">Remap</span>::<span style="color:#036;font-weight:bold">Base</span>
  define <span style="color:#080;font-weight:bold">do</span>
    to <span style="color:#A60">:nickname</span>, <span style="color:#606">map</span>: <span style="color:#A60">:person</span>, <span style="color:#A60">:name</span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>
</code></pre>

<blockquote>
<p>as well as deeply nested for improved readability</p>
</blockquote>

<pre class="code ruby"><code class="ruby"><span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Mapper</span> &lt; <span style="color:#036;font-weight:bold">Remap</span>::<span style="color:#036;font-weight:bold">Base</span>
  define <span style="color:#080;font-weight:bold">do</span>
    to <span style="color:#A60">:nickname</span> <span style="color:#080;font-weight:bold">do</span>
      map <span style="color:#A60">:person</span> <span style="color:#080;font-weight:bold">do</span>
        map <span style="color:#A60">:name</span>
      <span style="color:#080;font-weight:bold">end</span>
    <span style="color:#080;font-weight:bold">end</span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>
</code></pre>

<blockquote>
<p>the rules can be mixed to fix the data structure</p>
</blockquote>

<pre class="code ruby"><code class="ruby"><span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Mapper</span> &lt; <span style="color:#036;font-weight:bold">Remap</span>::<span style="color:#036;font-weight:bold">Base</span>
  define <span style="color:#080;font-weight:bold">do</span>
    map <span style="color:#A60">:person</span> <span style="color:#080;font-weight:bold">do</span>
      map <span style="color:#A60">:name</span> <span style="color:#080;font-weight:bold">do</span>
        to <span style="color:#A60">:nickname</span>
      <span style="color:#080;font-weight:bold">end</span>
    <span style="color:#080;font-weight:bold">end</span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>
</code></pre>

<blockquote>
<p>to invoke do the following</p>
</blockquote>

<pre class="code ruby"><code class="ruby">output = <span style="color:#036;font-weight:bold">Mapper</span>.call({ <span style="color:#606">person</span>: { <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">John</span><span style="color:#710">'</span></span> } })
output.result <span style="color:#777"># =&gt; { nickname: 'John' }</span>
</code></pre>

<h3 id="label-Select+all+elements+in+an+array">Select all elements in an array</h3>

<blockquote>
<p>Similar to JSONPath&#39;s `[*] operator and allows paths to dig into nested arrays and hashes</p>
</blockquote>

<pre class="code ruby"><code class="ruby"><span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Mapper</span> &lt; <span style="color:#036;font-weight:bold">Remap</span>::<span style="color:#036;font-weight:bold">Base</span>
  define <span style="color:#080;font-weight:bold">do</span>
    map [all, <span style="color:#A60">:name</span>]
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>

output = <span style="color:#036;font-weight:bold">Mapper</span>.call([{ <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">John</span><span style="color:#710">&quot;</span></span> }, { <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Jane</span><span style="color:#710">&quot;</span></span> }])
output.result <span style="color:#777"># =&gt; [&quot;John&quot;, &quot;Jane&quot;]</span>
</code></pre>

<h3 id="label-Fixed+values+predefined+in+the+mapper">Fixed values predefined in the mapper</h3>

<blockquote>
<p>A mapper instance can hold a set of pre-defined options. Use the <code>option</code> method to define a mappers requirement</p>
</blockquote>

<pre class="code ruby"><code class="ruby"><span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Mapper</span> &lt; <span style="color:#036;font-weight:bold">Remap</span>::<span style="color:#036;font-weight:bold">Base</span>
  option <span style="color:#A60">:name</span>

  define <span style="color:#080;font-weight:bold">do</span>
    set [<span style="color:#A60">:person</span>, <span style="color:#A60">:name</span>], <span style="color:#606">to</span>: option(<span style="color:#A60">:name</span>)
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>

output = <span style="color:#036;font-weight:bold">Mapper</span>.call({}, <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">John</span><span style="color:#710">&quot;</span></span>)
output.result <span style="color:#777"># =&gt; { person: { name: &quot;John&quot; } }</span>
</code></pre>

<h3 id="label-Fixed+value+defined+in+the+mapper">Fixed value defined in the mapper</h3>

<blockquote>
<p>Allows a fixed value to be merged into the final data structure</p>
</blockquote>

<pre class="code ruby"><code class="ruby"><span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Mapper</span> &lt; <span style="color:#036;font-weight:bold">Remap</span>::<span style="color:#036;font-weight:bold">Base</span>
  define <span style="color:#080;font-weight:bold">do</span>
    set [<span style="color:#A60">:api_key</span>], <span style="color:#606">to</span>: value(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">ABC-123</span><span style="color:#710">&quot;</span></span>)
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>

output = <span style="color:#036;font-weight:bold">Mapper</span>.call({})
output.result <span style="color:#777"># =&gt; { api_key: &quot;ABC-123&quot; }</span>
</code></pre>

<h3 id="label-Skip+mapping+rule+unless+some+condition+is+fulfilled">Skip mapping rule unless some condition is fulfilled</h3>

<blockquote>
<p><code>map</code> and <code>to</code> allows the user to define post-processors and conditions for selected values</p>
</blockquote>

<pre class="code ruby"><code class="ruby"><span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Mapper</span> &lt; <span style="color:#036;font-weight:bold">Remap</span>::<span style="color:#036;font-weight:bold">Base</span>
  define <span style="color:#080;font-weight:bold">do</span>
    each <span style="color:#080;font-weight:bold">do</span>
      map.if_not <span style="color:#080;font-weight:bold">do</span>
        value.include?(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">B</span><span style="color:#710">&quot;</span></span>)
      <span style="color:#080;font-weight:bold">end</span>
    <span style="color:#080;font-weight:bold">end</span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>

output = <span style="color:#036;font-weight:bold">Mapper</span>.call([<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">A</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">B</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">C</span><span style="color:#710">&quot;</span></span>])
output.result <span style="color:#777"># =&gt; [&quot;A&quot;, &quot;C&quot;]</span>
</code></pre>

<blockquote>
<p>or use <code>if</code> to reverse the selection</p>
</blockquote>

<pre class="code ruby"><code class="ruby"><span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Mapper</span> &lt; <span style="color:#036;font-weight:bold">Remap</span>::<span style="color:#036;font-weight:bold">Base</span>
  define <span style="color:#080;font-weight:bold">do</span>
    each <span style="color:#080;font-weight:bold">do</span>
      map.if <span style="color:#080;font-weight:bold">do</span>
        value.include?(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">B</span><span style="color:#710">&quot;</span></span>)
      <span style="color:#080;font-weight:bold">end</span>
    <span style="color:#080;font-weight:bold">end</span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>

output = <span style="color:#036;font-weight:bold">Mapper</span>.call([<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">A</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">B</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">C</span><span style="color:#710">&quot;</span></span>])
output.result <span style="color:#777"># =&gt; [&quot;B&quot;]</span>
</code></pre>

<h3 id="label-Map+to+a+fixed+set+of+values">Map to a fixed set of values</h3>

<blockquote>
<p><code>enum</code> lets the mapper define a finite set of values for a particular path</p>
</blockquote>

<pre class="code ruby"><code class="ruby"><span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Mapper</span> &lt; <span style="color:#036;font-weight:bold">Remap</span>::<span style="color:#036;font-weight:bold">Base</span>
  define <span style="color:#080;font-weight:bold">do</span>
    to <span style="color:#A60">:names</span> <span style="color:#080;font-weight:bold">do</span>
      map(<span style="color:#A60">:countries</span>, all, <span style="color:#A60">:name</span>).enum <span style="color:#080;font-weight:bold">do</span>
        from <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">USA</span><span style="color:#710">&quot;</span></span>, <span style="color:#606">to</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">US</span><span style="color:#710">&quot;</span></span>
        value <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">SWE</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">DE</span><span style="color:#710">&quot;</span></span>
        otherwise <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">OTHER</span><span style="color:#710">&quot;</span></span>
      <span style="color:#080;font-weight:bold">end</span>
    <span style="color:#080;font-weight:bold">end</span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>

output = <span style="color:#036;font-weight:bold">Mapper</span>.call({
  <span style="color:#606">countries</span>: [
    { <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">SWE</span><span style="color:#710">&quot;</span></span> },
    { <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">DE</span><span style="color:#710">&quot;</span></span> },
    { <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">USA</span><span style="color:#710">&quot;</span></span> },
    { <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">IT</span><span style="color:#710">&quot;</span></span> }
  ]
})

output.result <span style="color:#777"># =&gt; { names: [&quot;SWE&quot;, &quot;DE&quot;, &quot;US&quot;, &quot;OTHER&quot;] }</span>
</code></pre>

<h3 id="label-Pending+mapping">Pending mapping</h3>

<blockquote>
<p>Use <code>pending</code> on rules that has yet to be defined</p>
</blockquote>

<pre class="code ruby"><code class="ruby"><span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Mapper</span> &lt; <span style="color:#036;font-weight:bold">Remap</span>::<span style="color:#036;font-weight:bold">Base</span>
  define <span style="color:#080;font-weight:bold">do</span>
    map(<span style="color:#A60">:workplace</span>, <span style="color:#606">to</span>: <span style="color:#A60">:job</span>).pending
    map(<span style="color:#A60">:name</span>, <span style="color:#606">to</span>: <span style="color:#A60">:nickname</span>)
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>

output = <span style="color:#036;font-weight:bold">Mapper</span>.call({ <span style="color:#606">workplace</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Apple</span><span style="color:#710">&quot;</span></span>, <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">John</span><span style="color:#710">&quot;</span></span> })
output.result <span style="color:#777"># =&gt; { nickname: &quot;John&quot; }</span>
</code></pre>

<h3 id="label-Iterate+over+an+enumerable">Iterate over an enumerable</h3>

<blockquote>
<p><code>each</code> works similar to <code>all</code> and allows for arrays and hashes to be mixed</p>
</blockquote>

<pre class="code ruby"><code class="ruby"><span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Mapper</span> &lt; <span style="color:#036;font-weight:bold">Remap</span>::<span style="color:#036;font-weight:bold">Base</span>
  define <span style="color:#080;font-weight:bold">do</span>
    map <span style="color:#A60">:people</span>, <span style="color:#606">to</span>: <span style="color:#A60">:names</span> <span style="color:#080;font-weight:bold">do</span>
      each <span style="color:#080;font-weight:bold">do</span>
        map <span style="color:#A60">:name</span>
      <span style="color:#080;font-weight:bold">end</span>
    <span style="color:#080;font-weight:bold">end</span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>

output = <span style="color:#036;font-weight:bold">Mapper</span>.call({ <span style="color:#606">people</span>: [{ <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">John</span><span style="color:#710">&quot;</span></span> }] })
output.result <span style="color:#777"># =&gt; { names: [&quot;John&quot;] }</span>
</code></pre>

<blockquote>
<p>The scope gives access to a few handly values</p>
</blockquote>
<ul><li>
<p><code>value</code> current value</p>
</li><li>
<p><code>element</code> - defined by <code>each</code></p>
</li><li>
<p><code>index</code> defined by <code>each</code></p>
</li><li>
<p><code>key</code> defined by <code>to</code>, <code>map</code> and <code>each</code> on hashes</p>
</li><li>
<p><code>values</code> &amp; <code>input</code> yields the mapper input</p>
</li><li>
<p><code>mapper</code> the current mapper</p>
</li></ul>

<pre class="code ruby"><code class="ruby"><span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Mapper</span> &lt; <span style="color:#036;font-weight:bold">Remap</span>::<span style="color:#036;font-weight:bold">Base</span>
  define <span style="color:#080;font-weight:bold">do</span>
    map <span style="color:#A60">:people</span>, <span style="color:#606">to</span>: <span style="color:#A60">:names</span> <span style="color:#080;font-weight:bold">do</span>
      each <span style="color:#080;font-weight:bold">do</span>
        map(<span style="color:#A60">:name</span>).then <span style="color:#080;font-weight:bold">do</span>
          element
        <span style="color:#080;font-weight:bold">end</span>
      <span style="color:#080;font-weight:bold">end</span>
    <span style="color:#080;font-weight:bold">end</span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>

output = <span style="color:#036;font-weight:bold">Mapper</span>.call({ <span style="color:#606">people</span>: [{ <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">John</span><span style="color:#710">&quot;</span></span> }] })
output.result <span style="color:#777"># =&gt; [{ name: &quot;John&quot; }]</span>
</code></pre>

<blockquote>
<p>or <code>index</code> to get access to <code>each</code>&#39;s index</p>
</blockquote>

<pre class="code ruby"><code class="ruby"><span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Mapper</span> &lt; <span style="color:#036;font-weight:bold">Remap</span>::<span style="color:#036;font-weight:bold">Base</span>
  define <span style="color:#080;font-weight:bold">do</span>
    map <span style="color:#A60">:people</span>, <span style="color:#606">to</span>: <span style="color:#A60">:names</span> <span style="color:#080;font-weight:bold">do</span>
      each <span style="color:#080;font-weight:bold">do</span>
        map(<span style="color:#A60">:name</span>).then <span style="color:#080;font-weight:bold">do</span>
          index
        <span style="color:#080;font-weight:bold">end</span>
      <span style="color:#080;font-weight:bold">end</span>
    <span style="color:#080;font-weight:bold">end</span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>

output = <span style="color:#036;font-weight:bold">Mapper</span>.call({ <span style="color:#606">people</span>: [{ <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">John</span><span style="color:#710">&quot;</span></span> }] })
output.result <span style="color:#777"># =&gt; [0]</span>
</code></pre>

<h3 id="label-Post-process+a+mapped+value">Post-process a mapped value</h3>

<pre class="code ruby"><code class="ruby"><span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Mapper</span> &lt; <span style="color:#036;font-weight:bold">Remap</span>::<span style="color:#036;font-weight:bold">Base</span>
  define <span style="color:#080;font-weight:bold">do</span>
    map.adjust <span style="color:#080;font-weight:bold">do</span>
      <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>value<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">!</span><span style="color:#710">&quot;</span></span>
    <span style="color:#080;font-weight:bold">end</span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>

output = <span style="color:#036;font-weight:bold">Mapper</span>.call(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Hello</span><span style="color:#710">&quot;</span></span>)
output.result <span style="color:#777"># =&gt; &quot;Hello!&quot;</span>
</code></pre>

<h3 id="label-Select+element+at+index">Select element at index</h3>

<blockquote>
<p>Similar to JSONPath&#39;s <code>[n]</code> selector</p>
</blockquote>

<pre class="code ruby"><code class="ruby"><span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Mapper</span> &lt; <span style="color:#036;font-weight:bold">Remap</span>::<span style="color:#036;font-weight:bold">Base</span>
  define <span style="color:#080;font-weight:bold">do</span>
    map <span style="color:#A60">:people</span>, at(<span style="color:#00D">0</span>), <span style="color:#A60">:name</span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>

output = <span style="color:#036;font-weight:bold">Mapper</span>.call({ <span style="color:#606">people</span>: [{ <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">John</span><span style="color:#710">&quot;</span></span> }, { <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Jane</span><span style="color:#710">&quot;</span></span>}] })
output.result <span style="color:#777"># =&gt; &quot;John&quot;</span>
</code></pre>

<blockquote>
<p>or <code>first</code></p>
</blockquote>

<pre class="code ruby"><code class="ruby"><span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Mapper</span> &lt; <span style="color:#036;font-weight:bold">Remap</span>::<span style="color:#036;font-weight:bold">Base</span>
  define <span style="color:#080;font-weight:bold">do</span>
    map <span style="color:#A60">:people</span>, first, <span style="color:#A60">:name</span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>

output = <span style="color:#036;font-weight:bold">Mapper</span>.call({ <span style="color:#606">people</span>: [{ <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">John</span><span style="color:#710">&quot;</span></span> }, { <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Jane</span><span style="color:#710">&quot;</span></span>}] })
output.result <span style="color:#777"># =&gt; &quot;John&quot;</span>
</code></pre>

<blockquote>
<p>or <code>last</code></p>
</blockquote>

<pre class="code ruby"><code class="ruby"><span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Mapper</span> &lt; <span style="color:#036;font-weight:bold">Remap</span>::<span style="color:#036;font-weight:bold">Base</span>
  define <span style="color:#080;font-weight:bold">do</span>
    map <span style="color:#A60">:people</span>, last, <span style="color:#A60">:name</span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>

output = <span style="color:#036;font-weight:bold">Mapper</span>.call({ <span style="color:#606">people</span>: [{ <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">John</span><span style="color:#710">&quot;</span></span> }, { <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Jane</span><span style="color:#710">&quot;</span></span>}] })
output.result <span style="color:#777"># =&gt; &quot;Jane&quot;</span>
</code></pre>

<h3 id="label-Wrap+output">Wrap output</h3>

<blockquote>
<p>Wraps the mapped value in an array</p>
</blockquote>

<pre class="code ruby"><code class="ruby"><span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Mapper</span> &lt; <span style="color:#036;font-weight:bold">Remap</span>::<span style="color:#036;font-weight:bold">Base</span>
  define <span style="color:#080;font-weight:bold">do</span>
    to <span style="color:#A60">:names</span> <span style="color:#080;font-weight:bold">do</span>
      wrap(<span style="color:#A60">:array</span>) <span style="color:#080;font-weight:bold">do</span>
        map <span style="color:#A60">:name</span>
      <span style="color:#080;font-weight:bold">end</span>
    <span style="color:#080;font-weight:bold">end</span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>

output = <span style="color:#036;font-weight:bold">Mapper</span>.call({ <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">John</span><span style="color:#710">&quot;</span></span> })
output.result <span style="color:#777"># =&gt; { names: [&quot;John&quot;] }</span>
</code></pre>

<h3 id="label-Manually+skip+a+mapping">Manually skip a mapping</h3>

<blockquote>
<p>Use <code>skip!</code> to manually skip a field</p>
</blockquote>

<pre class="code ruby"><code class="ruby"><span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Mapper</span> &lt; <span style="color:#036;font-weight:bold">Remap</span>::<span style="color:#036;font-weight:bold">Base</span>
  define <span style="color:#080;font-weight:bold">do</span>
    map.then <span style="color:#080;font-weight:bold">do</span>
      skip!(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">I'll do this later</span><span style="color:#710">&quot;</span></span>)
    <span style="color:#080;font-weight:bold">end</span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>
</code></pre>

<h3 id="label-Combine+mappers+using+operators">Combine mappers using operators</h3>

<blockquote>
<p>Mappers can be combined using the logical operators <code>|</code>, <code>&amp;</code> and <code>^</code></p>
</blockquote>

<pre class="code ruby"><code class="ruby"><span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Vehicle</span> &lt; <span style="color:#036;font-weight:bold">Remap</span>::<span style="color:#036;font-weight:bold">Base</span>
  <span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Bicycle</span> &lt; <span style="color:#036;font-weight:bold">Remap</span>::<span style="color:#036;font-weight:bold">Base</span>
    contract <span style="color:#080;font-weight:bold">do</span>
      required(<span style="color:#A60">:gears</span>)
      required(<span style="color:#A60">:brand</span>)
    <span style="color:#080;font-weight:bold">end</span>

    define <span style="color:#080;font-weight:bold">do</span>
      to <span style="color:#A60">:bicycle</span>
    <span style="color:#080;font-weight:bold">end</span>
  <span style="color:#080;font-weight:bold">end</span>

  <span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Car</span> &lt; <span style="color:#036;font-weight:bold">Remap</span>::<span style="color:#036;font-weight:bold">Base</span>
    contract <span style="color:#080;font-weight:bold">do</span>
      required(<span style="color:#A60">:hybrid</span>)
      required(<span style="color:#A60">:fule</span>)
    <span style="color:#080;font-weight:bold">end</span>

    define <span style="color:#080;font-weight:bold">do</span>
      to <span style="color:#A60">:car</span>
    <span style="color:#080;font-weight:bold">end</span>
  <span style="color:#080;font-weight:bold">end</span>

  define <span style="color:#080;font-weight:bold">do</span>
    each <span style="color:#080;font-weight:bold">do</span>
      embed <span style="color:#036;font-weight:bold">Bicycle</span> | <span style="color:#036;font-weight:bold">Car</span>
    <span style="color:#080;font-weight:bold">end</span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>

output = <span style="color:#036;font-weight:bold">Vehicle</span>.call([
  { <span style="color:#606">gears</span>: <span style="color:#00D">3</span>, <span style="color:#606">brand</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Rose</span><span style="color:#710">&quot;</span></span> },
  { <span style="color:#606">hybrid</span>: <span style="color:#069">false</span>, <span style="color:#606">fule</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Petrol</span><span style="color:#710">&quot;</span></span> }
])
</code></pre>

<blockquote>
<p>Supported operators are <code>|</code>, <code>&amp;</code> and <code>^</code></p>
</blockquote>

<h3 id="label-Optional+mappings">Optional mappings</h3>

<blockquote>
<p>Use the optional mapping rules <code>to?</code> and <code>map?</code> to define optional rules. By default, <code>to</code> and <code>map</code> cause the mapper to fail when a path cannot be found. The optional rules will just be ignored. This is perfect during development as it allows for partial inputs without breaking the mapper</p>
</blockquote>

<pre class="code ruby"><code class="ruby"><span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> &lt; <span style="color:#036;font-weight:bold">Mapper</span>::<span style="color:#036;font-weight:bold">Base</span>
  define <span style="color:#080;font-weight:bold">do</span>
    get <span style="color:#A60">:person</span> <span style="color:#080;font-weight:bold">do</span>
      get <span style="color:#A60">:name</span> <span style="color:#777"># Required</span>
      get? <span style="color:#A60">:age</span> <span style="color:#777"># Optional</span>
    <span style="color:#080;font-weight:bold">end</span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>

<span style="color:#777"># OK!</span>
<span style="color:#036;font-weight:bold">Person</span>.call({
  <span style="color:#606">person</span>: {
    <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Linus</span><span style="color:#710">&quot;</span></span>
  }
})

<span style="color:#777"># OK!</span>
<span style="color:#036;font-weight:bold">Person</span>.call({
  <span style="color:#606">person</span>: {
    <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Linus</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606">age</span>: <span style="color:#00D">30</span>
  }
})

<span style="color:#777"># NOT OK</span>
<span style="color:#036;font-weight:bold">Person</span>.call({
  <span style="color:#606">person</span>: {
    <span style="color:#606">age</span>: <span style="color:#00D">30</span>
  }
})
</code></pre>
</div></div>

      <div id="footer">
  Generated on Tue Dec  7 21:37:35 2021 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.27 (ruby-3.0.3).
</div>

    </div>
  </body>
</html>